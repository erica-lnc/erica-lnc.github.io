<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµè§ˆå™¨å†…å­˜å¡«å……æµ‹è¯•å·¥å…·</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif;}
        body {padding: 20px; max-width: 500px; margin: 0 auto; background: #f5f5f5;}
        .container {background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
        h1 {font-size: 20px; color: #333; margin-bottom: 20px; text-align: center;}
        .config {margin: 20px 0;}
        .config input {width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;}
        .btn {width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; margin: 10px 0;}
        #startBtn {background: #2196F3; color: white;}
        #stopBtn {background: #f44336; color: white; display: none;}
        #clearBtn {background: #9e9e9e; color: white;}
        .status {margin: 20px 0; padding: 15px; border-radius: 5px; background: #f0f8ff; font-size: 16px;}
        .record {margin: 15px 0; padding: 10px; background: #e8f5e9; border-radius: 5px; color: #2e7d32; font-weight: 500;}
        .tip {margin-top: 20px; font-size: 14px; color: #666; line-height: 1.5;}
    </style>
</head>
<body>
    <div class="container">
        <h1>æµè§ˆå™¨å†…å­˜å¡«å……æµ‹è¯•å·¥å…·</h1>
        <!-- ä¸Šæ¬¡æµ‹è¯•è®°å½• -->
        <div class="record" id="lastRecord"></div>
        <!-- é…ç½®é¡¹ -->
        <div class="config">
            <label>æ¯æ¬¡å¡«å……å†…å­˜å¤§å°ï¼ˆMBï¼‰ï¼šé»˜è®¤20ï¼Œå»ºè®®10-50</label>
            <input type="number" id="perSize" value="20" min="5" max="100">
            <label>å¡«å……é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼šé»˜è®¤500ï¼Œå¡é¡¿å¯è°ƒå¤§</label>
            <input type="number" id="interval" value="500" min="100" max="2000">
        </div>
        <!-- æ“ä½œæŒ‰é’® -->
        <button class="btn" id="startBtn">å¼€å§‹å¡«å……æµ‹è¯•</button>
        <button class="btn" id="stopBtn">åœæ­¢å¡«å……</button>
        <button class="btn" id="clearBtn">æ¸…é™¤æœ¬åœ°è®°å½•</button>
        <!-- å®æ—¶çŠ¶æ€ -->
        <div class="status" id="status">çŠ¶æ€ï¼šæœªå¼€å§‹ | ç´¯è®¡å¡«å……ï¼š0 MB</div>
        <!-- æç¤º -->
        <div class="tip">
            1. é—ªé€€é‡å¯ç½‘é¡µåï¼Œä¸Šæ–¹ä¼šæ˜¾ç¤ºä¸Šæ¬¡å¡«å……æ€»é‡<br>
            2. æŒ‰F12æ‰“å¼€ã€æ§åˆ¶å°(Console)ã€‘æŸ¥çœ‹å®æ—¶æ—¥å¿—<br>
            3. æµ‹è¯•ä¸­æµè§ˆå™¨å¡é¡¿/é—ªé€€ä¸ºæ­£å¸¸ç°è±¡<br>
            4. ä»…å ç”¨æµè§ˆå™¨å†…å­˜ï¼Œä¸ä¼šå½±å“æ‰‹æœºç³»ç»Ÿå­˜å‚¨
        </div>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const perSize = document.getElementById('perSize');
        const interval = document.getElementById('interval');
        const status = document.getElementById('status');
        const lastRecord = document.getElementById('lastRecord');

        // å…¨å±€å˜é‡
        let fillTimer = null; // å¡«å……å®šæ—¶å™¨
        let totalMB = 0;      // ç´¯è®¡å¡«å……MB
        let isRunning = false;// æ˜¯å¦æ­£åœ¨è¿è¡Œ
        const STORAGE_KEY = 'memFillTestRecord'; // æœ¬åœ°å­˜å‚¨é”®å

        // åˆå§‹åŒ–ï¼šè¯»å–ä¸Šæ¬¡æµ‹è¯•è®°å½•
        initRecord();
        function initRecord() {
            const lastData = localStorage.getItem(STORAGE_KEY);
            if (lastData) {
                lastRecord.innerHTML = `ğŸ“Œ ä¸Šæ¬¡æµ‹è¯•è®°å½•ï¼šå¡«å……è‡³ ${lastData} MB æ—¶æµè§ˆå™¨é—ªé€€`;
            } else {
                lastRecord.innerHTML = `ğŸ“Œ æš‚æ— æµ‹è¯•è®°å½•ï¼Œé¦–æ¬¡è¿è¡Œè¯·ç‚¹å‡»å¼€å§‹`;
            }
        }

        // ç”ŸæˆæŒ‡å®šå¤§å°çš„å¤§å¯¹è±¡ï¼ˆå ç”¨å†…å­˜ï¼‰
        function createBigData(mb) {
            // 1MB = 1024*1024 å­—èŠ‚ï¼Œæ¯ä¸ªå­—ç¬¦å 2å­—èŠ‚ï¼Œæ‰€ä»¥1MBéœ€è¦524288ä¸ªå­—ç¬¦
            const mbToChar = mb * 524288;
            let bigStr = '';
            // å¿«é€Ÿç”Ÿæˆå¤§å­—ç¬¦ä¸²ï¼Œå ç”¨å†…å­˜
            for (let i = 0; i < mbToChar; i++) {
                bigStr += Math.random().toString(36).substring(2);
            }
            return bigStr;
        }

        // æ‰“å°æ—¥å¿—ï¼ˆæ§åˆ¶å°+æ›´æ–°é¡µé¢çŠ¶æ€ï¼‰
        function log(msg) {
            // æ§åˆ¶å°æ—¥å¿—ï¼ˆæ›¿ä»£Logcatï¼ŒæŒ‰F12æŸ¥çœ‹ï¼‰
            console.log(`[å†…å­˜æµ‹è¯•å·¥å…·] ${new Date().toLocaleTimeString()} | ${msg}`);
            // æ›´æ–°é¡µé¢çŠ¶æ€
            status.innerHTML = `çŠ¶æ€ï¼šè¿è¡Œä¸­ | ${msg}`;
        }

        // å•æ¬¡å¡«å……æ“ä½œ
        function fillOnce() {
            const perMB = Number(perSize.value);
            try {
                // åˆ›å»ºå¤§å¯¹è±¡å¹¶ä¿ç•™ï¼ˆä¸é”€æ¯ï¼ŒæŒç»­å ç”¨å†…å­˜ï¼‰
                window[`bigData_${Date.now()}`] = createBigData(perMB);
                totalMB += perMB;
                // è®°å½•æ—¥å¿—
                const logMsg = `ç´¯è®¡å¡«å……ï¼š${totalMB} MBï¼ˆæœ¬æ¬¡${perMB} MBï¼‰`;
                log(logMsg);
                // ä¸´æ—¶ä¿å­˜å½“å‰å€¼ï¼Œé˜²æ­¢ä¸­é€”é—ªé€€
                localStorage.setItem(STORAGE_KEY, totalMB);
            } catch (e) {
                // å†…å­˜ä¸è¶³æ•è·å¼‚å¸¸ï¼Œå¼ºåˆ¶åœæ­¢
                log(`å¡«å……å¤±è´¥ï¼šå†…å­˜ä¸è¶³ | æœ€ç»ˆç´¯è®¡${totalMB} MB`);
                stopFill();
                alert(`æµè§ˆå™¨å†…å­˜ä¸è¶³ï¼æœ€ç»ˆç´¯è®¡å¡«å……ï¼š${totalMB} MB`);
            }
        }

        // å¼€å§‹å¡«å……
        function startFill() {
            if (isRunning) return;
            // é‡ç½®ç´¯è®¡å€¼
            totalMB = 0;
            localStorage.removeItem(STORAGE_KEY);
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            isRunning = true;
            startBtn.style.display = 'none';
            stopBtn.style.display = 'block';
            // å¾ªç¯å¡«å……
            const fillInterval = Number(interval.value);
            fillOnce(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
            fillTimer = setInterval(fillOnce, fillInterval);
            log('å¼€å§‹å†…å­˜å¡«å……æµ‹è¯•...');
        }

        // åœæ­¢å¡«å……
        function stopFill() {
            isRunning = false;
            clearInterval(fillTimer);
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            startBtn.style.display = 'block';
            stopBtn.style.display = 'none';
            // è®°å½•æœ€ç»ˆå€¼ï¼ˆæ‰‹åŠ¨åœæ­¢çš„æƒ…å†µï¼‰
            if (totalMB > 0) {
                localStorage.setItem(STORAGE_KEY, totalMB);
                initRecord();
                log(`æ‰‹åŠ¨åœæ­¢å¡«å…… | æœ€ç»ˆç´¯è®¡${totalMB} MB`);
            }
        }

        // æ¸…é™¤æœ¬åœ°è®°å½•
        function clearRecord() {
            localStorage.removeItem(STORAGE_KEY);
            initRecord();
            alert('æœ¬åœ°æµ‹è¯•è®°å½•å·²æ¸…é™¤ï¼');
        }

        // ç»‘å®šäº‹ä»¶
        startBtn.addEventListener('click', startFill);
        stopBtn.addEventListener('click', stopFill);
        clearBtn.addEventListener('click', clearRecord);

        // é¡µé¢å¸è½½æ—¶åœæ­¢ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
        window.addEventListener('beforeunload', () => {
            if (isRunning) stopFill();
        });
    </script>
</body>
</html>
