<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ å…è´¹ç¨‹åºç”Ÿæˆå™¨ âœ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            padding: 35px;
            position: relative;
            overflow: hidden;
        }
        .container::before {
            content: "ğŸ’»";
            font-size: 120px;
            position: absolute;
            top: -20px;
            right: -20px;
            opacity: 0.05;
            transform: rotate(15deg);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .header p {
            color: #718096;
            font-size: 14px;
        }
        .status-bar {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            display: none;
        }
        .status-success {
            background-color: #e8f4f8;
            color: #4299e1;
            display: block;
        }
        .status-error {
            background-color: #fef2f2;
            color: #e53e3e;
            display: block;
        }
        .model-select-group {
            margin-bottom: 20px;
        }
        .model-select-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 16px;
        }
        .model-select-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            background-color: #fafafa;
            cursor: pointer;
        }
        .input-section {
            margin-bottom: 25px;
        }
        .input-section label {
            display: block;
            margin-bottom: 10px;
            color: #4a5568;
            font-weight: 600;
            font-size: 16px;
        }
        .input-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            resize: vertical;
            transition: border-color 0.3s;
            background-color: #fafafa;
        }
        .input-section textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        .btn-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        #generateBtn {
            background-color: #4299e1;
            color: white;
        }
        #generateBtn:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }
        #downloadBtn {
            background-color: #48bb78;
            color: white;
            display: none;
        }
        #downloadBtn:hover {
            background-color: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        .result-box {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }
        .result-header {
            background-color: #f7fafc;
            padding: 12px 18px;
            color: #2d3748;
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-content {
            padding: 18px;
            background-color: #ffffff;
            max-height: 300px;
            overflow-x: auto;
        }
        .result-content pre {
            font-size: 14px;
            line-height: 1.6;
            color: #2d3748;
        }
        .status {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }
        .loading {
            color: #4299e1;
            display: none;
        }
        .error {
            color: #e53e3e;
            display: none;
        }
        .hint {
            color: #ed8936;
            margin-top: 10px;
            font-size: 13px;
            text-align: center;
            display: none;
        }
        @media (max-width: 600px) {
            .container {
                padding: 25px;
                margin: 20px auto;
            }
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ å…è´¹ç¨‹åºç”Ÿæˆå™¨ âœ¨</h1>
            <p>é€‰æ‹©æ¨¡å‹ â†’ è¾“å…¥éœ€æ±‚ â†’ ä¸€é”®ç”Ÿæˆä¸‹è½½ ğŸš€</p>
        </div>

        <!-- æœåŠ¡å™¨è¿æ¥çŠ¶æ€æç¤º -->
        <div id="serverStatus" class="status-bar"></div>

        <!-- æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰æ¡† -->
        <div class="model-select-group">
            <label for="modelSelect">ğŸ¤– é€‰æ‹©å¯ç”¨æ¨¡å‹ï¼š</label>
            <select id="modelSelect" disabled>
                <option value="">åŠ è½½ä¸­...</option>
            </select>
        </div>

        <div class="input-section">
            <label for="prompt">ğŸ“ è¯·è¾“å…¥ä½ çš„ç¨‹åºéœ€æ±‚ï¼š</label>
            <textarea id="prompt" placeholder="ä¾‹å¦‚ï¼šç”Ÿæˆä¸€ä¸ªå¸¦å€’è®¡æ—¶åŠŸèƒ½çš„ç½‘é¡µï¼Œçº¯å‰ç«¯ï¼Œæ— åç«¯ä¾èµ–..."></textarea>
        </div>

        <div class="btn-group">
            <button id="generateBtn" class="btn" disabled>âš¡ ç”Ÿæˆä»£ç </button>
            <button id="downloadBtn" class="btn">ğŸ“¥ ä¸‹è½½æ–‡ä»¶</button>
        </div>

        <div class="status">
            <span class="loading" id="loading">æ­£åœ¨ç”Ÿæˆä¸­... è¯·ç¨å€™ â³</span>
            <span class="error" id="error">âŒ ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–é‡è¯•</span>
        </div>
        <div class="hint" id="hint">ğŸ’¡ æç¤ºï¼š1.æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡® 2.æŒ‰F12æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ 3.ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ”¯æŒè·¨åŸŸ</div>

        <div class="result-box" id="resultBox">
            <div class="result-header">
                <span>ğŸ“„ ç”Ÿæˆç»“æœ</span>
            </div>
            <div class="result-content">
                <pre id="result"></pre>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒé…ç½®åŒºåŸŸï¼ˆå¿…å¡«ï¼ï¼‰ ====================
        const SERVER_CONFIG = {
            // 1. å…±ç”¨æœåŠ¡å™¨çš„ã€æ¨¡å‹åˆ—è¡¨æ¥å£åœ°å€ã€‘ï¼ˆå¿…å¡«ï¼Œè·å–å¯ç”¨æ¨¡å‹ï¼‰
            modelListUrl: "https://free.v36.cm", 
            // 2. å…±ç”¨æœåŠ¡å™¨çš„ã€ä»£ç ç”Ÿæˆæ¥å£åœ°å€ã€‘ï¼ˆå¿…å¡«ï¼Œæäº¤ç”Ÿæˆè¯·æ±‚ï¼‰
            generateUrl: "https://free.v36.cm",
            // 3. æœåŠ¡å™¨éœ€è¦çš„è®¤è¯å¯†é’¥ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼Œæ²¡æœ‰åˆ™ç•™ç©ºï¼‰
            apiKey: "sk-bvcnqkYbJU7C6yGwDc07E3D3F7884c10897d8dB60f185fCe",
            // 4. æ¨¡å‹åˆ—è¡¨æ¥å£è¿”å›çš„å­—æ®µåï¼ˆæ ¹æ®æœåŠ¡å™¨å®é™…è¿”å›è°ƒæ•´ï¼‰
            // å‡è®¾æœåŠ¡å™¨è¿”å›æ ¼å¼ï¼š{ "models": ["model1", "model2"] } æˆ– { "data": ["model1"] }
            modelListField: "models" 
        };
        // =================================================================

        const modelSelect = document.getElementById('modelSelect');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const promptInput = document.getElementById('prompt');
        const resultBox = document.getElementById('resultBox');
        const result = document.getElementById('result');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const hint = document.getElementById('hint');
        const serverStatus = document.getElementById('serverStatus');

        // é¡µé¢åŠ è½½åï¼Œè‡ªåŠ¨è·å–æœåŠ¡å™¨æ¨¡å‹åˆ—è¡¨
        window.onload = async () => {
            await fetchModelList();
        };

        // ä»æœåŠ¡å™¨è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
        async function fetchModelList() {
            try {
                const headers = {};
                if (SERVER_CONFIG.apiKey) {
                    headers['Authorization'] = `Bearer ${SERVER_CONFIG.apiKey}`;
                }

                const response = await fetch(SERVER_CONFIG.modelListUrl, { headers });
                if (!response.ok) throw new Error(`æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼š${response.status}`);

                const data = await response.json();
                // æå–æ¨¡å‹åˆ—è¡¨ï¼ˆæ ¹æ®æœåŠ¡å™¨è¿”å›å­—æ®µè°ƒæ•´ï¼‰
                const modelList = data[SERVER_CONFIG.modelListField] || [];
                
                if (modelList.length === 0) {
                    throw new Error("æœåŠ¡å™¨æ— å¯ç”¨æ¨¡å‹");
                }

                // æ¸²æŸ“æ¨¡å‹ä¸‹æ‹‰æ¡†
                modelSelect.innerHTML = "";
                modelList.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });

                // æ›´æ–°çŠ¶æ€
                serverStatus.className = "status-bar status-success";
                serverStatus.textContent = `âœ… æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼Œå…± ${modelList.length} ä¸ªå¯ç”¨æ¨¡å‹`;
                modelSelect.disabled = false;
                generateBtn.disabled = false;
            } catch (err) {
                serverStatus.className = "status-bar status-error";
                serverStatus.textContent = `âŒ ${err.message}`;
                modelSelect.innerHTML = "<option value=''>è·å–å¤±è´¥</option>";
            }
        }

        // æå–ä»£ç å—
        function extractCode(text) {
            const htmlMatch = text.match(/```html([\s\S]*?)```/);
            if (htmlMatch) return htmlMatch[1].trim();
            const codeMatch = text.match(/```([\s\S]*?)```/);
            if (codeMatch) return codeMatch[1].trim();
            return text.trim();
        }

        // ç”Ÿæˆä»£ç æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        generateBtn.addEventListener('click', async () => {
            const selectedModel = modelSelect.value;
            const prompt = promptInput.value.trim();

            if (!selectedModel) {
                alert("è¯·é€‰æ‹©ä¸€ä¸ªå¯ç”¨æ¨¡å‹ï¼");
                return;
            }
            if (!prompt) {
                alert("è¯·è¾“å…¥ä½ çš„ç¨‹åºéœ€æ±‚ï¼");
                return;
            }

            // é‡ç½®çŠ¶æ€
            loading.style.display = 'inline';
            error.style.display = 'none';
            hint.style.display = 'none';
            resultBox.style.display = 'none';
            downloadBtn.style.display = 'none';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };
                if (SERVER_CONFIG.apiKey) {
                    headers['Authorization'] = `Bearer ${SERVER_CONFIG.apiKey}`;
                }

                // å‘é€ç”Ÿæˆè¯·æ±‚
                const response = await fetch(SERVER_CONFIG.generateUrl, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        model: selectedModel,
                        prompt: `ä½ æ˜¯å‰ç«¯å¼€å‘ä¸“å®¶ï¼Œä»…è¾“å‡ºHTML+CSS+JSä»£ç ï¼Œç”¨\`\`\`html\`\`\`åŒ…è£¹ï¼Œæ— ä»»ä½•è§£é‡Šæ–‡å­—ã€‚éœ€æ±‚ï¼š${prompt}`,
                        stream: false
                    })
                });

                if (!response.ok) throw new Error(`ç”Ÿæˆè¯·æ±‚å¤±è´¥ï¼š${response.status}`);
                const rawText = await response.text();
                console.log("æœåŠ¡å™¨åŸå§‹å“åº”ï¼š", rawText);

                // è§£æå“åº”ï¼ˆå…¼å®¹ä¸åŒæœåŠ¡å™¨è¿”å›æ ¼å¼ï¼‰
                let data;
                try {
                    data = JSON.parse(rawText);
                } catch (jsonErr) {
                    throw new Error(`å“åº”æ ¼å¼é”™è¯¯ï¼ŒéJSONï¼š${rawText.substring(0, 50)}...`);
                }

                // æå–AIç”Ÿæˆçš„å†…å®¹ï¼ˆæ ¹æ®æœåŠ¡å™¨è¿”å›å­—æ®µè°ƒæ•´ï¼‰
                let aiContent = data.response || data.content || data.choices?.[0]?.message?.content || "";
                if (!aiContent) throw new Error("æœåŠ¡å™¨æœªè¿”å›æœ‰æ•ˆä»£ç ");

                // æå–çº¯ä»£ç 
                const code = extractCode(aiContent);
                if (!code) throw new Error("æœªä»å“åº”ä¸­æå–åˆ°HTMLä»£ç ");

                // å±•ç¤ºç»“æœ
                result.textContent = code;
                resultBox.style.display = 'block';
                downloadBtn.style.display = 'block';
                window.generatedCode = code;

            } catch (err) {
                console.error("ç”Ÿæˆå¤±è´¥è¯¦æƒ…ï¼š", err);
                error.textContent = `âŒ ç”Ÿæˆå¤±è´¥ï¼š${err.message}`;
                error.style.display = 'inline';
                hint.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        });

        // ä¸‹è½½æ–‡ä»¶
        downloadBtn.addEventListener('click', () => {
            if (!window.generatedCode) return;
            const blob = new Blob([window.generatedCode], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ç”Ÿæˆçš„ç¨‹åº_${new Date().getTime()}.html`;
            a.click();
            URL.revokeObjectURL(a.href);
        });
    </script>
</body>
</html>
