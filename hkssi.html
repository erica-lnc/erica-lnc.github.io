<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>香港中學面試評分系統 | 純前端離線版</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    /* 全站仿宋體，贴合香港文書风格 */
    body { font-family: "FangSong", "仿宋", "SimSun", serif; background: #f0f2f5; padding: 15px; line-height: 1.7; }
    .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 25px; }
    .header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
    .header h1 { font-family: "FangSong", "仿宋"; color: #165DFF; font-size: 26px; margin-bottom: 8px; font-weight: 600; }
    .header p { font-family: "FangSong", "仿宋"; color: #666; font-size: 15px; }
    /* 語言切換 */
    .lang-switch { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
    .lang-btn { font-family: "FangSong", "仿宋"; padding: 8px 20px; border: 1px solid #ddd; border-radius: 100px; background: #fff; cursor: pointer; font-size: 15px; transition: all 0.3s; }
    .lang-btn.active { background: #165DFF; color: #fff; border-color: #165DFF; }
    /* 標籤頁 */
    .tab-nav { display: flex; justify-content: center; gap: 12px; margin-bottom: 25px; }
    .tab-btn { font-family: "FangSong", "仿宋"; padding: 10px 22px; border: none; border-radius: 100px; background: #f5f7fa; color: #333; font-size: 15px; cursor: pointer; transition: all 0.3s; }
    .tab-btn.active { background: #165DFF; color: #fff; }
    /* 卡片樣式 */
    .card { background: #fafbfc; border-radius: 16px; padding: 20px; margin-bottom: 20px; }
    .card h3 { font-family: "FangSong", "仿宋"; color: #165DFF; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; font-weight: 600; }
    .card h3::before { content: ""; width: 4px; height: 16px; background: #165DFF; border-radius: 2px; }
    .card .tip { font-family: "FangSong", "仿宋"; color: #666; font-size: 15px; margin-bottom: 15px; }
    /* 按鈕組 */
    .btn-group { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
    .btn { font-family: "FangSong", "仿宋"; padding: 10px 20px; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; transition: all 0.2s; }
    .btn-primary { background: #165DFF; color: #fff; }
    .btn-success { background: #00B42A; color: #fff; }
    .btn-danger { background: #F53F3F; color: #fff; }
    .btn:disabled { background: #e5e7eb; color: #999; cursor: not-allowed; }
    /* 文本域/文章展示 */
    .text-area { font-family: "FangSong", "仿宋"; width: 100%; height: 120px; padding: 15px; border: 1px solid #eee; border-radius: 10px; font-size: 15px; resize: none; margin: 10px 0; background: #fff; }
    .article-box { font-family: "FangSong", "仿宋"; width: 100%; min-height: 100px; padding: 15px; border: 1px solid #eee; border-radius: 10px; font-size: 15px; background: #fff; margin: 10px 0; line-height: 1.8; color: #333; }
    /* 分數展示 */
    .score-card { text-align: center; padding: 20px; border-radius: 16px; background: linear-gradient(135deg, #e8f4ff 0%, #f0f7ff 100%); margin: 15px 0; }
    .score-num { font-family: "FangSong", "仿宋"; font-size: 50px; font-weight: 700; color: #F53F3F; margin: 10px 0; }
    .score-desc { font-family: "FangSong", "仿宋"; color: #666; font-size: 15px; line-height: 1.5; }
    /* 狀態提示 */
    .status { font-family: "FangSong", "仿宋"; font-size: 14px; margin-top: 10px; padding: 8px; border-radius: 6px; }
    .status-success { color: #00B42A; background: #e8fdf0; }
    .status-loading { color: #165DFF; background: #e8f4ff; }
    .status-error { color: #F53F3F; background: #feeef0; }
    /* 隱藏類 */
    .hide { display: none !important; }
    /* 響應式 */
    @media (max-width: 500px) {
      .container { padding: 15px; }
      .header h1 { font-size: 22px; }
      .score-num { font-size: 36px; }
      .tab-btn, .btn { padding: 8px 15px; font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 頭部 -->
    <div class="header">
      <h1 id="title-cn">香港中學面試評分系統 | 純前端離線版</h1>
      <h1 id="title-en" class="hide">HK Secondary School Interview Scoring | Frontend Only</h1>
      <p id="desc-cn">語音轉文字·核心詞匹配打分·文章朗讀糾錯 | 繁中/英文/粵語支援</p>
      <p id="desc-en" class="hide">Speech to Text·Keyword Scoring·Reading Correction | TC/EN/YUE Supported</p>
    </div>

    <!-- 語言切換 -->
    <div class="lang-switch">
      <button class="lang-btn active" id="lang-cn" onclick="switchLang('cn')">繁體中文</button>
      <button class="lang-btn" id="lang-en" onclick="switchLang('en')">English</button>
    </div>

    <!-- 標籤頁導航 -->
    <div class="tab-nav">
      <button class="tab-btn active" id="tab-intro" onclick="switchTab('intro')" data-cn="自我介紹打分" data-en="Self-Intro Scoring"></button>
      <button class="tab-btn" id="tab-article" onclick="switchTab('article')" data-cn="朗讀文章糾錯" data-en="Reading Correction"></button>
    </div>

    <!-- 自我介紹打分模組 -->
    <div id="content-intro">
      <div class="card">
        <h3 id="intro-title-cn">自我介紹語音錄入</h3>
        <h3 id="intro-title-en" class="hide">Self-Intro Speech Input</h3>
        <p class="tip" id="intro-tip-cn">點擊錄製按鈕，說出自我介紹（支援繁中/粵語/英文），停止後自動轉文字並打分</p>
        <p class="tip" id="intro-tip-en" class="hide">Click record, speak your self-intro (TC/YUE/EN), auto convert to text and score</p>
        <div class="btn-group">
          <button class="btn btn-primary" id="start-intro" onclick="startRecord('intro')" data-cn="開始錄製" data-en="Start Record"></button>
          <button class="btn btn-danger" id="stop-intro" onclick="stopRecord('intro')" disabled data-cn="停止錄製" data-en="Stop Record"></button>
        </div>
        <textarea class="text-area" id="intro-text" placeholder="錄製的文字將顯示在這裡..."></textarea>
        <div class="score-card">
          <div id="score-title-cn">本次自我介紹得分</div>
          <div id="score-title-en" class="hide">Self-Intro Score</div>
          <div class="score-num" id="intro-score">0</div>
          <div class="score-desc" id="intro-desc-cn">匹配核心詞：<span id="intro-match">0</span> / 總核心詞：<span id="intro-total-key">103</span></div>
          <div class="score-desc" id="intro-desc-en" class="hide">Matched Keywords: <span id="intro-match-en">0</span> / Total: <span id="intro-total-key-en">103</span></div>
        </div>
        <div class="status" id="intro-status"></div>
      </div>
    </div>

    <!-- 朗讀文章糾錯模組 -->
    <div id="content-article" class="hide">
      <div class="card">
        <h3 id="article-title-cn">隨機獲取朗讀文章</h3>
        <h3 id="article-title-en" class="hide">Get Random Article</h3>
        <p class="tip" id="article-tip-cn">點擊獲取後隨機生成1篇文章，朗讀錄製後自動對比糾錯打分</p>
        <p class="tip" id="article-tip-en" class="hide">Click to get a random article, record and auto correct to score</p>
        <div class="btn-group">
          <button class="btn btn-success" id="get-article" onclick="getRandomArticle()" data-cn="獲取隨機文章" data-en="Get Random"></button>
          <button class="btn btn-primary" id="start-article" onclick="startRecord('article')" disabled data-cn="開始朗讀錄製" data-en="Start Reading"></button>
          <button class="btn btn-danger" id="stop-article" onclick="stopRecord('article')" disabled data-cn="停止錄製" data-en="Stop Record"></button>
        </div>
        <div class="article-box" id="article-content">
          <span id="article-empty-cn">請點擊上方按鈕獲取隨機文章</span>
          <span id="article-empty-en" class="hide">Click the button above to get a random article</span>
        </div>
        <div class="status" id="article-get-status"></div>
      </div>
      <div class="card">
        <h3 id="read-title-cn">你的朗讀文字</h3>
        <h3 id="read-title-en" class="hide">Your Reading Text</h3>
        <textarea class="text-area" id="article-text" placeholder="錄製的朗讀文字將顯示在這裡..."></textarea>
        <div class="score-card">
          <div id="read-score-title-cn">本次朗讀糾錯得分</div>
          <div id="read-score-title-en" class="hide">Reading Correction Score</div>
          <div class="score-num" id="article-score">0</div>
          <div class="score-desc" id="article-desc-cn">錯字/漏字：<span id="article-error">0</span> | 文章總字數：<span id="article-total-word">0</span> | 正確率：<span id="article-rate">0%</span></div>
          <div class="score-desc" id="article-desc-en" class="hide">Errors/Missing: <span id="article-error-en">0</span> | Total Words: <span id="article-total-word-en">0</span> | Accuracy: <span id="article-rate-en">0%</span></div>
        </div>
        <div class="status" id="article-score-status"></div>
      </div>
    </div>
  </div>

  <script>
    // 全域配置
    const globalConfig = {
      currentLang: 'cn', // 預設繁體中文
      currentTab: 'intro', // 預設自我介紹標籤
      isRecording: false, // 錄製狀態
      mediaRecorder: null,
      audioChunks: [],
      currentArticle: null // 當前選中的文章
    };

    // ********** 核心詞庫：繁中+英文各103個，分類獨立，香港中學面試專用 **********
    // 1. 繁體中文詞庫（103個，分5大類，香港面試高頻）
    const keywordDB_CN = [
      // 性格特徵描述(21)
      "開朗活潑", "主動積極", "熱情自信", "具責任感", "有毅力", "面對困難", "謙虛有禮", "樂於助人", "擅長團隊合作", "具適應力",
      "性格開朗", "責任心強", "堅持不懈", "勇於面對困難", "待人謙和", "禮貌待人", "熱心助人", "團隊協作", "適應能力強", "積極向上", "自信大方",
      // 學業及專長能力(32)
      "熱愛學習", "主動求知", "語文能力強", "擅長思考", "解難能力高", "邏輯思維強", "積極參與", "課外活動", "參與比賽", "獲得獎項",
      "比賽冠軍", "比賽優異獎", "自主學習", "求知慾強", "語言能力", "邏輯能力", "思維敏捷", "解決問題", "善於思考", "學業優異",
      "專長突出", "能力過硬", "積極參與活動", "競賽獲獎", "榮獲獎項", "學習能力強", "接受能力快", "善於總結", "歸納能力", "分析能力", "應變能力", "學術能力",
      // 興趣愛好(20)
      "熱愛運動", "游泳", "籃球", "足球", "熱衷閱讀", "享受音樂", "鋼琴", "小提琴", "繪畫創作", "編程設計",
      "閱讀書籍", "聽音樂", "樂器演奏", "美術創作", "繪畫", "程序設計", "體育鍛煉", "球類運動", "藝術創作", "數碼設計",
      // 關鍵句型結構(20)
      "您好", "我是", "畢業於", "小學名稱", "性格開朗且具責任感", "學生", "在學校", "積極參與", "活動", "科目",
      "特別擅長", "特定能力", "我希望", "升上中學後", "繼續發展", "興趣", "能力", "學習更多新事物", "謝謝老師", "給我這次機會",
      // 亮點加分詞(10，補足103個)
      "時間管理能力強", "平衡學業與活動", "追求卓越", "學習目標", "熱衷探索", "對知識的渴求", "自我挑戰", "不畏困難", "探索新知", "勇於挑戰"
    ];

    // 2. 英文詞庫（103個，與繁中一一對應，香港中學面試適配）
    const keywordDB_EN = [
      // Personality Traits(21)
      "Cheerful and lively", "Proactive and positive", "Enthusiastic and confident", "Responsible", "Perseverant", "Face difficulties", "Humble and polite", "Helpful", "Good at teamwork", "Adaptable",
      "Cheerful personality", "Strong sense of responsibility", "Persistent", "Dare to face difficulties", "Humble to others", "Polite", "Warm-hearted", "Team cooperation", "Strong adaptability", "Positive", "Confident and easy-going",
      // Academic & Professional Abilities(32)
      "Love learning", "Initiative to seek knowledge", "Strong language skills", "Good at thinking", "High problem-solving ability", "Strong logical thinking", "Active participation", "Extracurricular activities", "Participate in competitions", "Win awards",
      "Competition champion", "Merit award in competition", "Self-directed learning", "Strong curiosity", "Language ability", "Logical ability", "Quick thinking", "Solve problems", "Good at reflection", "Excellent academic performance",
      "Outstanding expertise", "Strong ability", "Active in activities", "Win competition awards", "Obtain awards", "Strong learning ability", "Quick acceptance", "Good at summarizing", "Inductive ability", "Analytical ability", "Adaptability", "Academic ability",
      // Hobbies & Interests(20)
      "Love sports", "Swimming", "Basketball", "Football", "Love reading", "Enjoy music", "Piano", "Violin", "Painting creation", "Programming design",
      "Read books", "Listen to music", "Musical instrument playing", "Art creation", "Painting", "Programming", "Physical exercise", "Ball games", "Art creation", "Digital design",
      // Key Sentence Structures(20)
      "Hello", "I am", "Graduated from", "Primary school name", "Cheerful and responsible personality", "Student", "At school", "Take an active part in", "Activities", "Subjects",
      "Specialize in", "Specific abilities", "I hope", "After entering middle school", "Continue to develop", "Hobbies", "Abilities", "Learn more new things", "Thank you teacher", "Give me this opportunity",
      // Highlight Bonus Words(10)
      "Strong time management skills", "Balance study and activities", "Strive for excellence", "Learning goals", "Passion for exploration", "Thirst for knowledge", "Self-challenge", "Dare to face difficulties", "Explore new knowledge", "Dare to challenge"
    ];

    // 3. 朗讀文章庫（繁中+英文各5篇，香港中學面試場景）
    const articleDB = {
      cn: [
        { title: "香港簡介1", content: "香港是高度繁榮的國際大都會，位於珠江口東側，是世界著名的自由貿易港，也是國際金融、貿易、航運中心，中西文化在這裡交融共生。" },
        { title: "香港簡介2", content: "香港的經濟以服務業為主，金融、旅遊、貿易及物流是四大支柱產業，當地教育制度完善，重視學生全面發展，培養學生獨立思考與解難能力。" },
        { title: "面試禮儀1", content: "中學面試時應提前到達，衣着整潔得體，言行有禮貌，回答問題時思路清晰，如實表達自身想法，同時展現自信與對學校的認同。" },
        { title: "面試禮儀2", content: "自我介紹是面試核心環節，應簡潔明瞭，突出個人優勢、學業表現與興趣特長，說明升中動機，避免冗長無意義的表述。" },
        { title: "學習規劃", content: "升上中學後，我希望能保持熱愛學習的態度，積極參與課外活動，平衡學業與興趣，提升自身綜合能力，努力成為優秀的中學生。" }
      ],
      en: [
        { title: "Hong Kong Intro 1", content: "Hong Kong is a highly prosperous international metropolis, located on the east side of the Pearl River Estuary. It is a world-famous free trade port and an international center for finance, trade and shipping, where Chinese and Western cultures blend together." },
        { title: "Hong Kong Intro 2", content: "Hong Kong's economy is dominated by the service industry, with finance, tourism, trade and logistics as its four pillar industries. The local education system is sound, emphasizing students' all-round development and cultivating their independent thinking and problem-solving abilities." },
        { title: "Interview Etiquette 1", content: "Arrive early for the secondary school interview, dress neatly and appropriately, behave politely, answer questions with clear thinking, express your thoughts truthfully, and show confidence and recognition of the school." },
        { title: "Interview Etiquette 2", content: "Self-introduction is a core part of the interview. It should be concise, highlighting personal strengths, academic performance and hobbies, explaining the motivation for entering secondary school, and avoiding lengthy and meaningless expressions." },
        { title: "Study Plan", content: "After entering secondary school, I hope to keep a love for learning, actively participate in extracurricular activities, balance study and hobbies, improve my comprehensive abilities, and strive to become an excellent secondary school student." }
      ]
    };

    // 頁面初始化
    window.onload = function() {
      document.getElementById('intro-total-key').textContent = keywordDB_CN.length;
      document.getElementById('intro-total-key-en').textContent = keywordDB_EN.length;
      if (!localStorage.getItem('hkInterviewLang')) localStorage.setItem('hkInterviewLang', 'cn');
      globalConfig.currentLang = localStorage.getItem('hkInterviewLang');
      switchLang(globalConfig.currentLang);
    };

    // ********** 基礎功能：語言切換/標籤頁切換 **********
    function switchLang(lang) {
      globalConfig.currentLang = lang;
      localStorage.setItem('hkInterviewLang', lang);
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`lang-${lang}`).classList.add('active');
      const allCn = document.querySelectorAll('[id$="-cn"]');
      const allEn = document.querySelectorAll('[id$="-en"]');
      allCn.forEach(el => el.classList.toggle('hide', lang === 'en'));
      allEn.forEach(el => el.classList.toggle('hide', lang === 'cn'));
      document.querySelectorAll('[data-cn]').forEach(btn => btn.textContent = btn.dataset[lang]);
    }

    function switchTab(tab) {
      globalConfig.currentTab = tab;
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`tab-${tab}`).classList.add('active');
      document.getElementById('content-intro').classList.toggle('hide', tab === 'article');
      document.getElementById('content-article').classList.toggle('hide', tab === 'intro');
    }

    // ********** 核心功能：語音轉文字（支援繁中/粵語/英文）**********
    function startRecord(type) {
      const startBtn = document.getElementById(`start-${type}`);
      const stopBtn = document.getElementById(`stop-${type}`);
      const status = document.getElementById(`${type}-status`);
      let speechLang = globalConfig.currentLang === 'cn' ? 'zh-HK' : 'en-US'; // zh-HK支援繁中+粵語
      if (type === 'intro' && globalConfig.currentLang === 'cn') speechLang = 'zh-HK'; // 粵語優先

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        showStatus(type, 'error', globalConfig.currentLang === 'cn' ? '你的瀏覽器不支援語音識別，請使用Chrome/Edge' : 'Browser not support Speech Recognition, use Chrome/Edge');
        return;
      }
      const recognition = new SpeechRecognition();
      recognition.lang = speechLang;
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = (e) => {
        const text = Array.from(e.results).map(res => res[0].transcript).join('');
        document.getElementById(`${type}-text`).value = text;
        if (e.results[0].isFinal) {
          stopRecord(type, true);
          type === 'intro' ? scoreIntro(text) : scoreArticle(text);
        }
      };

      recognition.onerror = (e) => {
        showStatus(type, 'error', globalConfig.currentLang === 'cn' ? `語音識別失敗：${e.error}` : `Speech Recognition Error: ${e.error}`);
        startBtn.disabled = false;
        stopBtn.disabled = true;
      };

      globalConfig.mediaRecorder = recognition;
      recognition.start();
      globalConfig.isRecording = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      showStatus(type, 'loading', globalConfig.currentLang === 'cn' ? '正在錄製，請說話...' : 'Recording, please speak...');
    }

    function stopRecord(type, isAuto = false) {
      const startBtn = document.getElementById(`start-${type}`);
      const stopBtn = document.getElementById(`stop-${type}`);
      if (globalConfig.mediaRecorder && globalConfig.isRecording) {
        globalConfig.mediaRecorder.stop();
        globalConfig.isRecording = false;
      }
      startBtn.disabled = false;
      stopBtn.disabled = true;
      if (!isAuto) {
        showStatus(type, 'success', globalConfig.currentLang === 'cn' ? '錄製已停止' : 'Recording stopped');
        const text = document.getElementById(`${type}-text`).value;
        if (text) type === 'intro' ? scoreIntro(text) : scoreArticle(text);
      }
    }

    // ********** 核心功能：打分邏輯 **********
    // 自我介紹打分：詞庫匹配度計算0-100分
    function scoreIntro(text) {
      const lang = globalConfig.currentLang;
      const keywords = lang === 'cn' ? keywordDB_CN : keywordDB_EN;
      let matchCount = 0;
      const lowerText = text.toLowerCase().replace(/[^\w\s]/g, '');
      keywords.forEach(key => {
        if (lowerText.includes(key.toLowerCase().replace(/[^\w\s]/g, ''))) matchCount++;
      });
      const score = Math.round((matchCount / keywords.length) * 100);
      document.getElementById('intro-score').textContent = score;
      document.getElementById('intro-match').textContent = matchCount;
      document.getElementById('intro-match-en').textContent = matchCount;
      showStatus('intro', 'success', lang === 'cn' ? `打分完成！匹配${matchCount}個核心詞` : `Scored! Matched ${matchCount} core keywords`);
    }

    // 朗讀文章打分：逐字對比計算正確率
    function scoreArticle(text) {
      if (!globalConfig.currentArticle) {
        showStatus('article', 'error', globalConfig.currentLang === 'cn' ? '請先獲取隨機文章' : 'Please get a random article first');
        return;
      }
      const articleContent = globalConfig.currentArticle.content;
      const cleanText = text.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '');
      const cleanArticle = articleContent.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '');
      const total
