<!DOCTYPE html>
<meta charset="utf-8">
<title> ç”¨æˆ·ç«¯</title>
<style>
  body{max-width:400px;margin:30px auto}
  input,button,textarea{width:100%;margin:8px 0;padding:10px}
</style>

<h3>ç”¨æˆ·æŸ¥è¯¢</h3>
<input id="input" placeholder="è¾“å…¥å†…å®¹" value="123">
<button onclick="go()">æŸ¥è¯¢</button>

<h3>ç»“æœ</h3>
<textarea id="out" rows="8" readonly></textarea>

<script>
// ==============================================
// ğŸ”’ ã€ç®¡ç†å‘˜ä¸“ç”¨ã€‘åªèƒ½åœ¨è¿™é‡Œæ”¹å¯†é’¥ï¼ˆç•Œé¢çœ‹ä¸è§ï¼‰
// ==============================================
const SEND_KEY = "123456789.abc.cbd";
const BACK_KEY = "987654321.cbd.abc";

// ==============================================
// ğŸ“ ã€ç®¡ç†å‘˜ä¸“ç”¨ã€‘åœ¨è¿™é‡Œæ”¹ B.html åœ°å€
// ==============================================
const B_URL = "ls.html";

// ==============================================
// åŠ å¯† / è§£å¯†ï¼ˆå›ºå®šç®—æ³•ï¼‰
// ==============================================
function xorEncrypt(str, key) {
  let r = "";
  for (let i=0; i<str.length; i++) {
    const kc = key.charCodeAt(i % key.length);
    const sc = str.charCodeAt(i);
    r += String.fromCharCode(sc ^ kc);
  }
  return btoa(encodeURIComponent(r));
}

function xorDecrypt(enc, key) {
  try {
    const d = decodeURIComponent(atob(enc));
    let r = "";
    for (let i=0; i<d.length; i++) {
      const kc = key.charCodeAt(i % key.length);
      const dc = d.charCodeAt(i);
      r += String.fromCharCode(dc ^ kc);
    }
    return r;
  } catch(e) {
    return "è§£å¯†å¤±è´¥";
  }
}

// ==============================================
// æŸ¥è¯¢é€»è¾‘
// ==============================================
async function go() {
  const t = document.getElementById("input").value;
  const out = document.getElementById("out");
  out.value = "åŠ å¯†ä¸­...";

  const enc = xorEncrypt(t, SEND_KEY);
  out.value = "è¾“å…¥ï¼š" + t + "\nåŠ å¯†ï¼š" + enc + "\n\nè¯»å– B æ–‡ä»¶...";

  try {
    const res = await fetch(B_URL);
    const txt = await res.text();
    out.value += "\nB å†…å®¹ï¼š\n" + txt + "\n";

    const reg = /"([^"]+)"\s*=\s*"([^"]+)"/g;
    let m, ok = false;
    while ((m = reg.exec(txt)) !== null) {
      if (m[1] === enc) {
        const final = xorDecrypt(m[2], BACK_KEY);
        out.value += "\nâœ… ç»“æœï¼š" + final;
        ok = true;
        break;
      }
    }
    if (!ok) out.value += "\nâŒ æ— åŒ¹é…";
  } catch (e) {
    out.value += "\nâŒ è¯»å–å¤±è´¥ï¼š" + e.message;
  }
}
</script>
