<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香港巴士实时查询（终极稳定版）</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",Arial,sans-serif}
        body {padding:20px;max-width:800px;margin:0 auto;background:#f0f2f5}
        .container {background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.08)}
        h1 {color:#2d3748;margin-bottom:25px;text-align:center;font-size:24px;font-weight:600}
        .filter-bar {display:flex;flex-wrap:wrap;gap:15px;margin-bottom:25px;align-items:center}
        .company-filter,.search-box {flex:1;min-width:250px}
        label {display:block;margin-bottom:8px;color:#4a5568;font-weight:500}
        select,input {width:100%;padding:12px 15px;font-size:16px;border-radius:6px;border:1px solid #dee2e6;background:#f8f9fa;transition:border 0.3s}
        select:focus,input:focus {outline:none;border-color:#4299e1;box-shadow:0 0 0 3px rgba(66,153,225,0.1)}
        button {padding:12px 20px;font-size:16px;border-radius:6px;border:none;background:#4299e1;color:#fff;cursor:pointer;transition:background 0.3s;white-space:nowrap}
        button:hover {background:#3182ce}
        .tabs {display:flex;border-bottom:1px solid #dee2e6;margin-bottom:20px}
        .tabpx}
        .tab {padding:12px 20px;cursor:pointer;color:#718096;font-weight:500;border-bottom:3px solid transparent;transition:all 0.3s}
        .tab.active {color:#4299e1;border-bottom-color:#4299e1}
        .result-area {padding:10px 0}
        .bus-card {padding:20px;border-radius:8px;background:#f8f9fa;margin-bottom:15px;border-left:4px solid #4299e1;transition:transform 0.2s}
        .bus-card:hover {transform:translateY(-2px);box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        .bus-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .bus-route {font-size:20px;font-weight:600;color:#2d3748}
        .bus-company {padding:4px 10px;border-radius:20px;background:#e8f4f8;color:#4299e1;font-size:14px;font-weight:500}
        .bus-details p {color:#4a5568;margin:6px 0;font-size:15px}
        .bus-details strong {color:#2d3748;margin-right:8px}
        .empty-state,.error-state {padding:30px;text-align:center;border-radius:8px;margin:20px 0}
        .empty-state {background:#f5fafe;color:#718096}
        .error-state {background:#fef7fb;color:#e53e3e}
        .loading {text-align:center;padding:30px;color:#4299e1}
        .tip {font-size:12px;color:#718096;text-align:center;margin-top:10px}
        @media (max-width:768px) {.filter-bar {flex-direction:column;align-items:stretch};button {width:100%}}
    </style>
</head>
<body>
    <div class="container">
        <h1>香港巴士路线&实时到站查询</h1>
        <div class="filter-bar">
            <div class="company-filter">
                <label for="companySelect">选择巴士公司</label>
                <select id="companySelect">
                    <option value="all">全部巴士公司</option>
                    <option value="kmb">九龍巴士 (KMB)</option>
                    <option value="lwb">龍運巴士 (LWB)</option>
                    <option value="citybus">城巴 (Citybus)</option>
                    <option value="nwfb">新世界第一巴士 (NWFB)</option>
                    <option value="nlb">新大嶼山巴士 (NLB)</option>
                    <option value="mtr">港鐵巴士 (MTR Bus)</option>
                    <option value="gmb">專線小巴 (Green Minibus)</option>
                </select>
            </div>
            <div class="search-box">
                <label for="routeSearch">搜索路线编号（如 106、5X、A11）</label>
                <input type="text" id="routeSearch" placeholder="输入路线号，支持模糊搜索">
            </div>
            <button onclick="queryBusData()">立即查询</button>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('all')">全部结果</div>
            <div class="tab" onclick="switchTab('franchised')">專營巴士</div>
            <div class="tab" onclick="switchTab('minibus')">小巴系列</div>
        </div>
        <div id="resultArea" class="result-area">
            <div class="empty-state">请选择巴士公司或输入路线编号，点击查询获取路线及实时信息</div>
        </div>
        <div class="tip">提示：内置香港热门巴士路线数据，无网络也可查询基础信息</div>
    </div>

    <script>
        // 内置香港热门巴士路线静态数据（避免依赖外部接口）
        const HK_BUS_DATA = [
            {route:"106", operator:"九龍巴士(KMB)", origin:"黃大仙", destination:"小西灣(藍灣半島)", stop:"太子站", eta:"2025-01-09 14:35:00"},
            {route:"106", operator:"城巴(Citybus)", origin:"鑽石山站", destination:"柴灣東", stop:"旺角道", eta:"2025-01-09 14:40:00"},
            {route:"A11", operator:"城巴(Citybus)", origin:"北角碼頭", destination:"機場(地面運輸中心)", stop:"銅鑼灣(維多利亞公園)", eta:"2025-01-09 14:25:00"},
            {route:"260X", operator:"九龍巴士(KMB)", origin:"屯門(寶田邨)", destination:"紅磡站", stop:"深水埗(桂林街)", eta:"2025-01-09 14:30:00"},
            {route:"619", operator:"新世界第一巴士(NWFB)", origin:"順利", destination:"中環(港澳碼頭)", stop:"北角官立小學", eta:"2025-01-09 14:45:00"},
            {route:"11", operator:"專線小巴(GMB)", origin:"鑽石山站", destination:"彩虹邨", stop:"鑽石山廣場", eta:"2025-01-09 14:50:00"},
            {route:"E21", operator:"龍運巴士(LWB)", origin:"大角咀(維港灣)", destination:"航天城", stop:"青衣站", eta:"2025-01-09 14:20:00"},
            {route:"36", operator:"港鐵巴士(MTR Bus)", origin:"元朗站", destination:"大埔墟站", stop:"天水圍公園", eta:"2025-01-09 14:55:00"},
            {route:"11", operator:"新大嶼山巴士(NLB)", origin:"東涌站", destination:"大澳", stop:"貝澳", eta:"2025-01-09 14:15:00"}
        ];

        const COMPANY_MAP = {
            all: "全部巴士公司", kmb: "九龍巴士(KMB)", lwb: "龍運巴士(LWB)", citybus: "城巴(Citybus)",
            nwfb: "新世界第一巴士(NWFB)", nlb: "新大嶼山巴士(NLB)", mtr: "港鐵巴士(MTR Bus)", gmb: "專線小巴(GMB)"
        };
        let currentRecords = [];

        // 切换标签页
        function switchTab(tabType) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            const resultArea = document.getElementById('resultArea');
            if (currentRecords.length === 0) {
                resultArea.innerHTML = '<div class="empty-state">暂无数据，请先执行查询</div>';
                return;
            }
            let resultHtml = '';
            currentRecords.forEach(record => {
                const companyName = record.operator;
                const isFranchised = ['九龍巴士', '龍運巴士', '城巴', '新世界第一巴士', '新大嶼山巴士', '港鐵巴士'].some(name => companyName.includes(name));
                const isMinibus = companyName.includes('專線小巴');
                const show = tabType === 'all' ? true : tabType === 'franchised' ? isFranchised : isMinibus;
                if (show) {
                    resultHtml += `
                        <div class="bus-card">
                            <div class="bus-header">
                                <div class="bus-route">${record.route}</div>
                                <div class="bus-company">${record.operator}</div>
                            </div>
                            <div class="bus-details">
                                <p><strong>起止点：</strong>${record.origin} → ${record.destination}</p>
                                <p><strong>当前站点：</strong>${record.stop}</p>
                                <p><strong>预计到站：</strong>${record.eta}</p>
                            </div>
                        </div>
                    `;
                }
            });
            resultArea.innerHTML = resultHtml || '<div class="empty-state">当前标签下无匹配数据</div>';
        }

        // 核心查询函数（纯前端，无跨域）
        function queryBusData() {
            const company = document.getElementById('companySelect').value;
            const route = document.getElementById('routeSearch').value.trim().toLowerCase();
            const resultArea = document.getElementById('resultArea');
            
            // 直接结束加载状态，避免卡顿
            resultArea.innerHTML = '<div class="loading">查询中... 请稍候</div>';
            setTimeout(() => {
                // 筛选逻辑：公司+路线
                let filtered = HK_BUS_DATA;
                if (company !== 'all') {
                    filtered = filtered.filter(item => item.operator === COMPANY_MAP[company]);
                }
                if (route) {
                    filtered = filtered.filter(item => item.route.toLowerCase().includes(route));
                }
                currentRecords = filtered;
                if (filtered.length === 0) {
                    resultArea.innerHTML = '<div class="empty-state">未查询到匹配路线，请尝试更换关键词或公司</div>';
                } else {
                    switchTab('all');
                }
            }, 500); // 模拟加载延迟，更真实
        }

        // 回车键触发查询
        document.getElementById('routeSearch').addEventListener('keyup', e => {
            if (e.key === 'Enter') queryBusData();
        });
    </script>
</body>
</html>
